<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <title>EasiNote 前端回调测试</title>
</head>

<body>

    <h1>EasiNote 前端回调测试页面</h1>

    <div id="app">

        <el-button-group>
            <el-button type="primary" @click="check2Tab(0)">1 通用回调 InvokeMethod</el-button>
            <el-button type="primary" @click="check2Tab(1)">2 执行自定义方法</el-button>
        </el-button-group>

        <div class="grid-content" v-if="showTabIndex === 0">
            <h3>1 执行通用回调 InvokeMethod</h3>
            <p>window.external.InvokeMethod(JSON.stringify({ "method": "实际方法名", "args": JSON.stringify({ "参数1": "值1",
                "参数2": "值2", "参数3": "值3" })}))</p>

            <el-link type="primary" target="_blank"
                href="https://github.com/EasiNote/EasiNote.ClientWebApi.Documentation/blob/test/zh-CN/apis/README.md">
                相关文档
            </el-link>

            <p>将要执行的语句是：{{resultJsCode1}}</p>

            <h4>方法名</h4>
            <el-row type="flex" class="row-bg">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">

                        <el-select v-model="commonMethodName" filterable allow-create default-first-option
                            placeholder="请选择或输入方法名">
                            <el-option v-for="item in methodOptions" :key="item.value" :label="item.label"
                                :value="item.value">
                            </el-option>
                        </el-select>

                    </div>
                </el-col>
            </el-row>

            <h4>参数</h4>

            <el-row class="row-bg" gutter="20">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">
                        <el-input v-model="commonMethodParamName1" placeholder="参数名1"></el-input>
                    </div>
                </el-col>

                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="4" v-model="commonMethodParamValue1" placeholder="参数值1">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-row class="row-bg" gutter="20">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">
                        <el-input v-model="commonMethodParamName2" placeholder="参数名2"></el-input>
                    </div>
                </el-col>

                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="4" v-model="commonMethodParamValue2" placeholder="参数值2">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-button type="primary" @click="invokeCommonMethod">执行</el-button>
        </div>

        <div class="grid-content" v-if="showTabIndex === 1">
            <h3>2 执行自定义方法</h3>
            <p>window.external.{自定义方法}("参数1","参数2")</p>

            <p>将要执行的语句是：{{resultJsCode2}}</p>

            <h4>方法名</h4>
            <el-row type="flex" class="row-bg">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">
                        <el-select v-model="commonMethodName" filterable allow-create default-first-option
                            placeholder="请选择或输入方法名">
                            <el-option v-for="item in methodOptions" :key="item.value" :label="item.label"
                                :value="item.value">
                            </el-option>
                        </el-select>
                    </div>
                </el-col>
            </el-row>

            <h4>参数</h4>

            <el-row class="row-bg" gutter="20">
                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="6" v-model="commonMethodParamValue1" placeholder="参数值1">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-row class="row-bg" gutter="20">
                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="6" v-model="commonMethodParamValue2" placeholder="参数值2">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-button style="margin: 1em 0em" type="primary" @click="invokeCustomMethod">执行</el-button>
        </div>

    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<script>
    function isEmpty(obj) {
        if (typeof obj == "undefined" || obj == null || obj == "") {
            return true;
        } else {
            return false;
        }
    }

    var app = new Vue({
        el: "#app",
        data: {
            commonMethodName: "",
            commonMethodParamName1: "",
            commonMethodParamValue1: "",
            commonMethodParamName2: "",
            commonMethodParamValue2: "",
            showTabIndex: 1,

            methodOptions: [{
                value: 'InsertElement',
                label: 'InsertElement'
            }, {
                value: 'InsertMedia',
                label: 'InsertMedia'
            }, ],
        },
        computed: {
            resultJsCode1: function () {
                return `window.external.InvokeMethod("${this.commonInvokeMethodJson}")`;
            },

            resultJsCode2: function () {
                let code = `window.external.${this.commonMethodName}()`;
                let param1 = `${this.commonMethodParamValue1}`;
                let param2 = `${this.commonMethodParamValue2}`;

                if (!isEmpty(this.commonMethodParamValue1)) {
                    code = `window.external.${this.commonMethodName}("${param1}")`;
                }
                if (!isEmpty(this.commonMethodParamValue2)) {
                    code = `window.external.${this.commonMethodName}("${param1}", "${param2}")`;
                }

                return code;
            },

            commonInvokeMethodJson: function(){
                let methodName = this.commonMethodName;
                let pn1 = this.commonMethodParamName1;
                let pn2 = this.commonMethodParamName2;
                let p1 = this.commonMethodParamValue1;
                let p2 = this.commonMethodParamValue2;

                params = {};
                params[pn1] = p1;
                params[pn2] = p2;

                return JSON.stringify({
                    "method": methodName,
                    "args": params
                });
            }

        },
        methods: {

            invokeCommonMethod() {
                window.external.InvokeMethod(this.commonInvokeMethodJson)
            },

            invokeCustomMethod() {

                let code = `window.external.${this.commonMethodName}()`;
                let param1 = `${this.commonMethodParamValue1}`;
                let param2 = `${this.commonMethodParamValue2}`;

                if (!isEmpty(this.commonMethodParamValue1)) {
                    code = `window.external.${this.commonMethodName}(param1)`;
                }
                if (!isEmpty(this.commonMethodParamValue2)) {
                    code = `window.external.${this.commonMethodName}(param1, param2)`;
                }

                eval(code);
            },

            check2Tab(tabIndex) {
                this.showTabIndex = tabIndex;
            }

        }
    });
</script>

</html>