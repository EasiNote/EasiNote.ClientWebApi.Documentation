<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <title>EasiNote 前端回调测试</title>
</head>

<body>

    <h2>EasiNote 前端回调测试页面</h2>

    <div id="app">

        <el-button-group>
            <el-button type="primary" @click="check2Tab(0)">1 通用回调 InvokeMethod</el-button>
            <el-button type="primary" @click="check2Tab(1)">2 执行自定义方法</el-button>
            <el-button type="primary" @click="check2Tab(2)">3 创建 web presentation card 元素</el-button>
            <el-button type="primary" @click="check2Tab(3)">4 插入多媒体（图片，音视频）元素</el-button>
        </el-button-group>

        <div class="grid-content" v-if="showTabIndex === 0">
            <h3>1 执行通用回调 InvokeMethod</h3>
            <p>window.external.InvokeMethod(JSON.stringify({ "method": "实际方法名", "args": JSON.stringify({ "参数1": "值1",
                "参数2": "值2", "参数3": "值3" })}))</p>

            <el-link type="primary" target="_blank"
                href="https://github.com/EasiNote/EasiNote.ClientWebApi.Documentation/blob/test/zh-CN/apis/README.md">
                相关文档
            </el-link>

            <p>将要执行的语句是：{{resultJsCode1}}</p>

            <h4>方法名</h4>
            <el-row type="flex" class="row-bg">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">

                        <el-select v-model="commonMethodName" filterable allow-create default-first-option
                            placeholder="请选择或输入方法名">
                            <el-option v-for="item in methodOptions" :key="item.value" :label="item.label"
                                :value="item.value">
                            </el-option>
                        </el-select>

                    </div>
                </el-col>
            </el-row>

            <h4>参数</h4>

            <el-row class="row-bg" gutter="20">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">
                        <el-input v-model="commonMethodParamName1" placeholder="参数名1"></el-input>
                    </div>
                </el-col>

                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="4" v-model="commonMethodParamValue1" placeholder="参数值1">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-row class="row-bg" gutter="20">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">
                        <el-input v-model="commonMethodParamName2" placeholder="参数名2"></el-input>
                    </div>
                </el-col>

                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="4" v-model="commonMethodParamValue2" placeholder="参数值2">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-button type="primary" @click="invokeCommonMethod">执行</el-button>
        </div>

        <div class="grid-content" v-if="showTabIndex === 1">
            <h3>2 执行自定义方法</h3>
            <p>window.external.{自定义方法}("参数1","参数2")</p>

            <p>将要执行的语句是：{{resultJsCode2}}</p>

            <h4>方法名</h4>
            <el-row type="flex" class="row-bg">
                <el-col :span="4">
                    <div class="grid-content bg-purple-light">
                        <el-select v-model="commonMethodName" filterable allow-create default-first-option
                            placeholder="请选择或输入方法名">
                            <el-option v-for="item in methodOptions" :key="item.value" :label="item.label"
                                :value="item.value">
                            </el-option>
                        </el-select>
                    </div>
                </el-col>
            </el-row>

            <h4>参数</h4>

            <el-row class="row-bg" gutter="20">
                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="6" v-model="commonMethodParamValue1" placeholder="参数值1">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-row class="row-bg" gutter="20">
                <el-col :span="20">
                    <div class="grid-content bg-purple-light">
                        <el-input type="textarea" :rows="6" v-model="commonMethodParamValue2" placeholder="参数值2">
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-button style="margin: 1em 0em" type="primary" @click="invokeCustomMethod">执行</el-button>
        </div>

        <div class="grid-content" v-if="showTabIndex === 2">
            <h3>3 创建 web presentation card 元素</h3>

            <h4>创建参数</h4>
            <el-row class="row-bg" gutter="5">
                <el-col :span="18">
                    <div class="grid-content bg-purple-light">

                        <el-form label-position="right" label-width="360px" :model="webPresentationCard">
                            <el-form-item label="标签(CardTag)">
                                <el-input v-model="webPresentationCard.cardTag"></el-input>
                            </el-form-item>
                            <el-form-item label="标题(title)">
                                <el-input v-model="webPresentationCard.title"></el-input>
                            </el-form-item>
                            <el-form-item label="点击标题(clickTitle)">
                                <el-input v-model="webPresentationCard.clickTitle"></el-input>
                            </el-form-item>
                            <el-form-item label="断网点击标题(offlineClickTitle)">
                                <el-input v-model="webPresentationCard.offlineClickTitle"></el-input>
                            </el-form-item>
                            <el-form-item label="缩略图(thumbnailUri)">
                                <el-input v-model="webPresentationCard.thumbnailUri"></el-input>
                            </el-form-item>
                            <el-form-item label="备课端web页(editingUrl)">
                                <el-input v-model="webPresentationCard.editingUrl"></el-input>
                            </el-form-item>
                            <el-form-item label="授课端web页(displayUrl)">
                                <el-input v-model="webPresentationCard.displayUrl"></el-input>
                            </el-form-item>
                            <el-form-item label="备课端窗口大小(editingPresentationSize)">
                                <el-row class="row-bg">
                                    <el-col :span="6">
                                        <div class="grid-content bg-purple-light">
                                            <el-input v-model="webPresentationCard.editingPresentationSize.width">
                                            </el-input>
                                        </div>
                                    </el-col>
                                    <el-col :span="6">
                                        <div class="grid-content bg-purple-light">
                                            <el-input v-model="webPresentationCard.editingPresentationSize.height">
                                            </el-input>
                                        </div>
                                    </el-col>
                                </el-row>
                            </el-form-item>
                            <el-form-item label="授课端窗口大小(displayPresentationSize)">
                                <el-row class="row-bg">
                                    <el-col :span="6">
                                        <div class="grid-content bg-purple-light">
                                            <el-input v-model="webPresentationCard.displayPresentationSize.width">
                                            </el-input>
                                        </div>
                                    </el-col>
                                    <el-col :span="6">
                                        <div class="grid-content bg-purple-light">
                                            <el-input v-model="webPresentationCard.displayPresentationSize.height">
                                            </el-input>
                                        </div>
                                    </el-col>
                                </el-row>
                            </el-form-item>
                            <el-form-item label="web 页窗口标题(presentationWindowTitle)">
                                <el-input v-model="webPresentationCard.presentationWindowTitle"></el-input>
                            </el-form-item>
                            <el-form-item label="备课端 web 页窗口 icon (editingWindowIconUri)">
                                <el-input v-model="webPresentationCard.editingWindowIconUri"></el-input>
                            </el-form-item>
                            <el-form-item label="授课端 web 页窗口 icon (displayWindowIconUri)">
                                <el-input v-model="webPresentationCard.displayWindowIconUri"></el-input>
                            </el-form-item>
                            <el-form-item label="授课端 web 页窗口的显示模式(displayMode)">
                                <el-select v-model="webPresentationCard.displayMode" placeholder="请选择">
                                    <el-option v-for="item in displayModeOptions" :key="item.value" :label="item.label"
                                        :value="item.value">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="备课端元素缩放模式(zoomMode)">
                                <el-select v-model="webPresentationCard.zoomMode" placeholder="请选择">
                                    <el-option v-for="item in zoomModeOptions" :key="item.value" :label="item.label"
                                        :value="item.value">
                                    </el-option>
                                </el-select>
                            </el-form-item>


                        </el-form>

                    </div>
                </el-col>

                <el-col :span="6">
                    <el-input type="textarea" :rows="38" v-model="webPresentationCardJson">
                    </el-input>
                </el-col>

            </el-row>

            <el-button style="margin: 1em 0em" type="primary" @click="createWebPresentationCord">创建 web presentation card 元素</el-button>

        </div>

        <div class="grid-content" v-if="showTabIndex === 3">
            <h3>4 插入多媒体（图片，音视频）元素</h3>

            <h4>参数</h4>
            <el-row type="flex" class="row-bg" gutter="5">
                <el-col :span="16">
                    <div class="grid-content bg-purple-light">

                        <el-form label-position="right" label-width="240px" :model="insertMediaData">
                            <el-form-item label="下载链接(url)">
                                <el-input v-model="insertMediaData.url"></el-input>
                            </el-form-item>
                            <el-form-item label="文件名(fileName) 必须有后缀">
                                <el-input v-model="insertMediaData.fileName"></el-input>
                            </el-form-item>
                            <el-form-item label="音视频插入类型(mode)">
                                <el-select v-model="insertMediaData.mode" placeholder="请选择">
                                    <el-option v-for="item in mediaInsertModeOptions" :key="item.value" :label="item.label"
                                        :value="item.value">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="是否自动播放(isAutoPlay)">
                                <el-checkbox v-model="insertMediaData.isAutoPlay">是否自动播放</el-checkbox>
                            </el-form-item>
                        </el-form>

                    </div>
                </el-col>

                <el-col :span="8">
                    <el-input type="textarea" :rows="10" v-model="insertMediaDataJson">
                    </el-input>
                </el-col>

            </el-row>

            <el-button style="margin: 1em 0em" type="primary" @click="insertMediaElement">创建 web presentation card 元素</el-button>

        </div>

    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<script>
    function isEmpty(obj) {
        if (typeof obj == "undefined" || obj == null || obj == "") {
            return true;
        } else {
            return false;
        }
    }

    var app = new Vue({
        el: "#app",
        data: {
            commonMethodName: "",
            commonMethodParamName1: "",
            commonMethodParamValue1: "",
            commonMethodParamName2: "",
            commonMethodParamValue2: "",
            showTabIndex: 1,

            methodOptions: [{
                value: 'InsertElement',
                label: 'InsertElement'
            }, {
                value: 'InsertElementByJson',
                label: 'InsertElementByJson'
            }, {
                value: 'InsertMedia',
                label: 'InsertMedia'
            }, ],

            webPresentationCard: {
                cardTag: 'TEST',
                title: '测试标题',
                isTitleVisible: true,
                thumbnailUri: 'http://n.sinaimg.cn/sinakd20200605ac/416/w640h576/20200605/301b-iurnkpq9297963.jpg',
                isThumbnailVisible: true,
                clickTitle: '点击',
                offlineClickTitle: '网络错误',
                editingUrl: 'https://bilibili.com',
                displayUrl: 'https://www.zhihu.com/',
                editingPresentationSize: {
                    width: 1000,
                    height: 500,
                },
                displayPresentationSize: {
                    width: 1000,
                    height: 500,
                },
                presentationWindowTitle: '窗口标题',
                editingWindowIconUri: 'http://n.sinaimg.cn/sinakd20200605ac/186/w640h346/20200605/a50a-iurnkpq9297973.jpg',
                displayWindowIconUri: 'https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4267424444,91867147&fm=26&gp=0.jpg',
                displayMode: 'Window',
                zoomMode: 'Scale'
            },

            displayModeOptions: [{
                value: 'Window',
                label: 'Window'
            }, {
                value: 'FullScreen',
                label: 'FullScreen'
            }, ],

            zoomModeOptions: [{
                value: 'Scale',
                label: 'Scale'
            }, {
                value: 'Adaptive',
                label: 'Adaptive'
            }, ],

            insertMediaData:{
                url: "https://img.nga.178.com/attachments/mon_201911/08/-9lddQ5-fnlpXoZ6mT3cSu0-1o0.png",
                fileName: "测试图片.png",
                mode: "online",
                isAutoPlay: true
            },

            mediaInsertModeOptions:[{
                value: 'online',
                label: 'online'
            }, {
                value: 'download',
                label: 'download'
            }, ],

        },
        computed: {
            resultJsCode1: function () {
                return `window.external.InvokeMethod("${this.commonInvokeMethodJson}")`;
            },

            resultJsCode2: function () {
                let code = `window.external.${this.commonMethodName}()`;
                let param1 = `${this.commonMethodParamValue1}`;
                let param2 = `${this.commonMethodParamValue2}`;

                if (!isEmpty(this.commonMethodParamValue1)) {
                    code = `window.external.${this.commonMethodName}("${param1}")`;
                }
                if (!isEmpty(this.commonMethodParamValue2)) {
                    code = `window.external.${this.commonMethodName}("${param1}", "${param2}")`;
                }

                return code;
            },

            commonInvokeMethodJson: function () {
                let methodName = this.commonMethodName;
                let pn1 = this.commonMethodParamName1;
                let pn2 = this.commonMethodParamName2;
                let p1 = this.commonMethodParamValue1;
                let p2 = this.commonMethodParamValue2;

                params = {};
                params[pn1] = p1;
                params[pn2] = p2;

                return JSON.stringify({
                    "method": methodName,
                    "args": params
                });
            },

            webPresentationCardJson: function () {
                return JSON.stringify(this.webPresentationCard, null, 2);
            },

            insertMediaDataJson: function () {
                return JSON.stringify(this.insertMediaData, null, 2);
            },

        },
        methods: {

            invokeCommonMethod() {
                window.external.InvokeMethod(this.commonInvokeMethodJson)
            },

            invokeCustomMethod() {

                let code = `window.external.${this.commonMethodName}()`;
                let param1 = `${this.commonMethodParamValue1}`;
                let param2 = `${this.commonMethodParamValue2}`;

                if (!isEmpty(this.commonMethodParamValue1)) {
                    code = `window.external.${this.commonMethodName}(param1)`;
                }
                if (!isEmpty(this.commonMethodParamValue2)) {
                    code = `window.external.${this.commonMethodName}(param1, param2)`;
                }

                eval(code);
            },

            check2Tab(tabIndex) {
                this.showTabIndex = tabIndex;
            },

            createWebPresentationCord(){
                window.external.InsertElementByJson('WebPresentationCard', this.webPresentationCardJson);
            },

            insertMediaElement(){
                window.external.InsertMedia(this.insertMediaDataJson);
            },

        }
    });
</script>

</html>