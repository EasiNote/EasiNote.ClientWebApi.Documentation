(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{883:function(t,s,a){t.exports=a.p+"assets/img/2021-10-19-12-09-07.de05fe05.png"},934:function(t,s,a){"use strict";a.r(s);var e=a(8),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"学科工具扩展的用户识别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#学科工具扩展的用户识别"}},[t._v("#")]),t._v(" 学科工具扩展的用户识别")]),t._v(" "),e("p",[t._v("在按照 "),e("RouterLink",{attrs:{to:"/apis/extend-subject-tool/02Configurations.html"}},[t._v("配置说明")]),t._v(" 中的配置完成设置，生成插件之后，就可以用扩展的学科工具提供内容服务了。")],1),t._v(" "),e("p",[t._v("但此时内容页无法知道当前登录的用户是谁，无法提供个性化的服务。")]),t._v(" "),e("p",[t._v("最简单的，可以要求用户在打开学科工具之后，在内容页进行登录。但这样每次使用学科工具都需要登录一次，交互过于繁琐。")]),t._v(" "),e("p",[t._v("希沃白板学科工具扩展提供两种方案，可以告知当前登录的用户信息。")]),t._v(" "),e("h2",{attrs:{id:"方案1-对接希沃开放平台"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方案1-对接希沃开放平台"}},[t._v("#")]),t._v(" 方案1 对接希沃开放平台")]),t._v(" "),e("p",[t._v("如果对接了"),e("a",{attrs:{href:"http://open.seewo.com/#/service/1112/doc/1695",target:"_blank",rel:"noopener noreferrer"}},[t._v("希沃开放平台"),e("OutboundLink")],1),t._v(" 的帐号系统进行登录，则可以直接通过 javascript API 接口获取到用户信息。")]),t._v(" "),e("blockquote",[e("p",[t._v("希沃开放平台还可以对接第三方账号登录，相关说明见："),e("RouterLink",{attrs:{to:"/guide/01Account.html"}},[t._v("账号登录")])],1)]),t._v(" "),e("p",[t._v("具体而言，业务的 URL 上不需要额外的参数")]),t._v(" "),e("p",[e("code",[t._v("http://xxx.com/resource?aaa=123")])]),t._v(" "),e("p",[t._v("需要通过 javascript 脚本来获取到用户的信息。")]),t._v(" "),e("ul",[e("li",[t._v("获取希沃用户ID")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取希沃用户ID")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("externalAsync"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetAccountInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("返回数据示例 "),e("code",[t._v('{\\"t_user_id\\":\\"\\",\\"user_id\\":\\"smwytvyzsorknpyvnvlygjys66289121\\"}')])]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"t_user_id"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 第三方用户ID，通过定制方式使用第三方账号登录才有值")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"user_id"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"smwytvyzsorknpyvnvlygjys66289121"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// seewo 用户ID，用户登录之后有值")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("ul",[e("li",[t._v("获取 OAUTH 鉴权使用的 CODE")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据 app_id 获取鉴权使用的 CODE (app_id 指希沃开放平台申请的 app_id)")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("externalAsync"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetOpenOAuthCode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app_id'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("返回数据示例 "),e("code",[t._v('{\\"success\\":true,\\"error_code\\":0,\\"message\\":\\"OK\\",\\"code\\":\\"fb2f757941bd405db51f2ccb13660783\\"}')])]),t._v(" "),e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"success"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error_code"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OK"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fb2f757941bd405db51f2ccb13660783"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("img",{attrs:{src:a(883),alt:"dev tools"}})]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"title"},[t._v("特别提示")]),e("p",[t._v("因为用户在实际使用时，可能会反复打开学科工具，为了避免每次都需要向开放平台鉴权。\n在第一次鉴权完成之后，需要将用户ID等获取到的信息保存下来（如存到 localStorage 中）。\n下一次用户打开窗口时，如果用户ID没有变（通过 GetAccountInfo 获取当前的），则不需要再次调用 GetOpenOAuthCode 进行重新鉴权操作。")])]),e("h2",{attrs:{id:"方案2-url-上使用特定的用户-id-标记"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方案2-url-上使用特定的用户-id-标记"}},[t._v("#")]),t._v(" 方案2 URL 上使用特定的用户 ID 标记")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"title"},[t._v("警告")]),e("p",[t._v("此方案依赖客户端的实现，客户端软件灵活性较差，难以应对后续需求变更。\n对于需要经过希沃资源中心进行批量分发的资源插件，请勿使用此方式获取用户信息。")])]),e("p",[t._v("如果应用没有对接希沃开放平台，则没有第三方账号相关的数据。此时可以提供希沃用户ID。")]),t._v(" "),e("p",[t._v("具体而言，要求业务方的 URL 样式是")]),t._v(" "),e("p",[e("code",[t._v("http://xxx.com/resource?aaa=123&swUserId={SW_USER_ID}&timestamp={TIMESTAMP}&tickct={TICKET}")])]),t._v(" "),e("p",[t._v("在真实调用时，会将其中的参数进行替换。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("{SW_USER_ID}"),e("br"),t._v("\n希沃的用户ID"),e("br"),t._v("\n如果用户没有登录，则此值为 "),e("code",[t._v("anonymous")]),t._v("。")])]),t._v(" "),e("li",[e("p",[t._v("{TIMESTAMP}"),e("br"),t._v("\n时间戳（毫秒）")])]),t._v(" "),e("li",[e("p",[t._v("{TICKET}"),e("br"),t._v("\n校验用的 ticket"),e("br"),t._v(" "),e("code",[t._v('ticket = MD5($"{timestamp}{swUserId}{secretKey}")')]),e("br"),t._v("\n这里的 secretKey 是一个加密混淆用的，由 EN5 在线下向相关方提供。")])])]),t._v(" "),e("p",[t._v("使用此种方式，内容提供方在第一次无法直接根据 SW_USER_ID 确定用户是谁。\n根据实际情况，在首次使用时，可能需要要求用户进行账号绑定，然后将绑定结果记录在内容提供方的数据库中，下次用户使用时，就可以自动登入使用了。或者给用户直接创建一个新的账号。")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"title"},[t._v("提示")]),e("p",[t._v("当此方式不依赖与希沃开放平台的对接，仅供小批量自行分发的插件使用。\n基本上已经遗弃，后续可能不再提供支持。")])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"title"},[t._v("风险提示")]),e("p",[t._v("在用户首次使用业务时，需要让用户进行账号关联确认，直接进行账号绑定或新建账号，可能有法律风险。")])])])}),[],!1,null,null,null);s.default=n.exports}}]);